<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Care & Share Exchange</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        header nav {
            margin-top: 1rem;
        }

        header nav button {
            margin: 0 5px;
            padding: 0.5rem 1rem;
            background-color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
        }

        header nav button:hover {
            background-color: #ddd;
        }

        main {
            padding: 2rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card {
            background-color: white;
            padding: 1rem;
            border-radius: 10px;
            flex: 1 1 200px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .card img {
            width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }

        form input, form select, form textarea, form button {
            display: block;
            width: 100%;
            margin-bottom: 1rem;
            padding: 0.5rem;
        }

        form button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        form button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<header>
    <h1>Care & Share Exchange Platform</h1>
    <nav>
        <button onclick="showSection('itemsSection')">All Items</button>
        <button onclick="showSection('exchangeSection')">Exchange Items</button>
        <button onclick="showSection('createItemSection')">Add Item</button>
        <button onclick="showSection('exchangeRequestsSection')">Exchange Requests</button>
    </nav>
</header>

<main>
    <!-- All Items -->
    <section id="itemsSection" class="section active">
        <h2>All Items</h2>
        <div id="itemsList" class="grid"></div>
    </section>

    <!-- Exchange Items -->
    <section id="exchangeSection" class="section">
        <h2>Exchange Items</h2>
        <div id="exchangeList" class="grid"></div>
    </section>

    <!-- Create Item -->
    <section id="createItemSection" class="section">
        <h2>Create Item</h2>
        <form id="createItemForm">
            <input type="number" id="itemId" placeholder="Item ID" required>
            <input type="text" id="title" placeholder="Title" required>
            <input type="text" id="type" placeholder="Type" required>
            <select id="category" required>
                <option value="">Select Category</option>
                <option value="resell">Resell</option>
                <option value="donate">Donate</option>
                <option value="exchange">Exchange</option>
            </select>
            <input type="text" id="itemCondition" placeholder="Condition" required>
            <textarea id="description" placeholder="Description"></textarea>
            <input type="text" id="ownerName" placeholder="Owner Name">
            <input type="email" id="ownerEmail" placeholder="Owner Email">
            <input type="text" id="phoneNumber" placeholder="Phone Number" required>
            <input type="text" id="address" placeholder="Address">
            <select id="status">
                <option value="available">Available</option>
                <option value="pending">Pending</option>
                <option value="sold">Sold</option>
            </select>
            <button type="submit">Create Item</button>
        </form>
    </section>

    <!-- Exchange Requests -->
    <section id="exchangeRequestsSection" class="section">
        <h2>Exchange Requests</h2>
        <div id="exchangeRequestsList" class="grid"></div>
    </section>
</main>

<script>
    const apiBase = "http://localhost:8080/api";

    function showSection(id) {
        document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
        document.getElementById(id).classList.add("active");

        if (id === "itemsSection") fetchItems();
        if (id === "exchangeSection") fetchExchangeItems();
        if (id === "exchangeRequestsSection") fetchExchangeRequests();
    }

    // ------------------ FETCH ITEMS ------------------
    async function fetchItems() {
        const res = await fetch(`${apiBase}/items`);
        const items = await res.json();
        const container = document.getElementById("itemsList");
        container.innerHTML = "";
        items.forEach(item => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <h3>${item.title}</h3>
                <p>Type: ${item.type}</p>
                <p>Category: ${item.category}</p>
                <p>Status: ${item.status}</p>
                <p>Owner: ${item.ownerName} (${item.ownerEmail})</p>
                <p>Phone: ${item.phoneNumber}</p>
                <p>Address: ${item.address}</p>
                <p>Description: ${item.description}</p>
                ${item.image ? `<img src="data:${item.imageType};base64,${item.imageBase64}" alt="Item Image"/>` : ""}
            `;
            container.appendChild(card);
        });
    }

    // ------------------ FETCH EXCHANGE ITEMS ------------------
    async function fetchExchangeItems() {
        const res = await fetch(`${apiBase}/exchange/items`);
        const items = await res.json();
        const container = document.getElementById("exchangeList");
        container.innerHTML = "";
        items.forEach(item => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <h3>${item.title}</h3>
                <p>Type: ${item.type}</p>
                <p>Status: ${item.status}</p>
                <button onclick="createExchangeRequest(${item.id})">Request Exchange</button>
            `;
            container.appendChild(card);
        });
    }

    // ------------------ CREATE ITEM ------------------
    document.getElementById("createItemForm").addEventListener("submit", async e => {
        e.preventDefault();
        const data = [{
            id: parseInt(document.getElementById("itemId").value),
            title: document.getElementById("title").value,
            type: document.getElementById("type").value,
            category: document.getElementById("category").value,
            itemCondition: document.getElementById("itemCondition").value,
            description: document.getElementById("description").value,
            ownerName: document.getElementById("ownerName").value,
            ownerEmail: document.getElementById("ownerEmail").value,
            phoneNumber: document.getElementById("phoneNumber").value,
            address: document.getElementById("address").value,
            status: document.getElementById("status").value
        }];
        const res = await fetch(`${apiBase}/items`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(data)
        });
        if (res.ok) {
            alert("Item created successfully!");
            document.getElementById("createItemForm").reset();
            fetchItems();
        } else {
            alert("Failed to create item");
        }
    });

    // ------------------ EXCHANGE REQUESTS ------------------
    async function fetchExchangeRequests() {
        const res = await fetch(`${apiBase}/exchange/requests`);
        const requests = await res.json();
        const container = document.getElementById("exchangeRequestsList");
        container.innerHTML = "";
        requests.forEach(req => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <p>Request ID: ${req.id}</p>
                <p>Requester Item ID: ${req.requesterItemId}</p>
                <p>Requested Item ID: ${req.requestedItemId}</p>
                <p>Status: ${req.status}</p>
                ${req.status === 'pending' ? `
                <button onclick="acceptExchange(${req.id})">Accept</button>
                <button onclick="rejectExchange(${req.id})">Reject</button>
                ` : ""}
            `;
            container.appendChild(card);
        });
    }

    async function createExchangeRequest(requestedItemId) {
        const requesterItemId = prompt("Enter your item ID to offer for exchange:");
        if (!requesterItemId) return;
        const res = await fetch(`${apiBase}/exchange/request?requesterItemId=${requesterItemId}&requestedItemId=${requestedItemId}`, { method: "POST" });
        if (res.ok) {
            alert("Exchange request created!");
            fetchExchangeRequests();
        } else {
            const err = await res.text();
            alert("Failed: " + err);
        }
    }

    async function acceptExchange(id) {
        const res = await fetch(`${apiBase}/exchange/request/${id}/accept`, { method: "POST" });
        if (res.ok) {
            alert("Exchange accepted!");
            fetchExchangeRequests();
            fetchItems();
            fetchExchangeItems();
        }
    }

    async function rejectExchange(id) {
        const res = await fetch(`${apiBase}/exchange/request/${id}/reject`, { method: "POST" });
        if (res.ok) {
            alert("Exchange rejected!");
            fetchExchangeRequests();
        }
    }

    // Initialize
    showSection("itemsSection");
</script>
</body>
</html>
